<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: #fafafa;
            min-height: 100vh;
            padding: 40px 20px;
            color: #1a1a1a;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: #1a1a1a;
            margin-bottom: 60px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e0e0e0;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 0.95em;
            color: #666;
            font-weight: 400;
        }

        .stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: white;
            padding: 25px 35px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            text-align: center;
            min-width: 160px;
            border: 1px solid #e8e8e8;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #1a1a1a;
            display: block;
            line-height: 1;
        }

        .stat-label {
            color: #666;
            font-size: 0.8em;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 500;
        }

        .prompt-card {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #e8e8e8;
            position: relative;
        }

        .prompt-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }

        .prompt-label {
            color: #999;
            font-size: 0.7em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 12px;
        }

        .prompt-text {
            font-size: 1.15em;
            color: #333;
            line-height: 1.6;
        }

        .refresh-prompt {
            position: absolute;
            top: 25px;
            right: 25px;
            background: transparent;
            border: 1px solid #e0e0e0;
            color: #666;
            cursor: pointer;
            font-size: 0.9em;
            padding: 6px 12px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .refresh-prompt:hover {
            background: #f5f5f5;
            border-color: #ccc;
        }

        .writing-area {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid #e8e8e8;
        }

        .writing-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            align-items: center;
            flex-wrap: wrap;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .goal-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .goal-btn {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            background: white;
            color: #666;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
            font-weight: 500;
        }

        .goal-btn:hover {
            background: #f5f5f5;
            border-color: #ccc;
        }

        .goal-btn.active {
            background: #1a1a1a;
            color: white;
            border-color: #1a1a1a;
        }

        .timer {
            font-size: 1.1em;
            color: #666;
            font-weight: 500;
            margin-left: auto;
        }

        .photo-section {
            margin-bottom: 25px;
        }

        .photo-btn {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            background: white;
            color: #666;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
            font-weight: 500;
        }

        .photo-btn:hover {
            background: #f5f5f5;
            border-color: #ccc;
        }

        .photo-preview {
            margin-top: 20px;
            display: none;
            position: relative;
        }

        .photo-preview.has-photo {
            display: block;
        }

        .photo-preview img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .remove-photo {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-weight: 300;
        }

        .remove-photo:hover {
            background: #1a1a1a;
        }

        .formatting-toolbar {
            display: flex;
            gap: 4px;
            margin-bottom: 20px;
            padding: 8px;
            background: #f8f8f8;
            border-radius: 6px;
            flex-wrap: wrap;
        }

        .format-btn {
            padding: 8px 14px;
            border: 1px solid #e0e0e0;
            background: white;
            color: #666;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
            font-weight: 500;
        }

        .format-btn:hover {
            background: #f0f0f0;
            border-color: #ccc;
        }

        .format-btn.active {
            background: #1a1a1a;
            color: white;
            border-color: #1a1a1a;
        }

        .rich-editor {
            min-height: 400px;
            border: none;
            font-size: 1.05em;
            line-height: 1.8;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            color: #1a1a1a;
            outline: none;
            background: transparent;
            overflow-y: auto;
        }

        .rich-editor:empty:before {
            content: attr(data-placeholder);
            color: #999;
        }

        .rich-editor h1 {
            font-size: 2.2em;
            font-weight: 700;
            line-height: 1.2;
            margin: 0.5em 0;
            letter-spacing: -0.5px;
        }

        .rich-editor h2 {
            font-size: 1.6em;
            font-weight: 600;
            line-height: 1.3;
            margin: 0.6em 0;
            letter-spacing: -0.3px;
        }

        .rich-editor h3 {
            font-size: 1.3em;
            font-weight: 600;
            line-height: 1.4;
            margin: 0.5em 0;
        }

        .rich-editor p {
            font-size: 1em;
            line-height: 1.8;
            margin: 0.8em 0;
        }

        .rich-editor blockquote {
            border-left: 3px solid #1a1a1a;
            padding-left: 20px;
            margin: 1.5em 0;
            font-style: italic;
            color: #555;
        }

        .rich-editor strong {
            font-weight: 600;
        }

        .rich-editor em {
            font-style: italic;
        }

        .word-count {
            text-align: right;
            color: #999;
            font-size: 0.8em;
            margin-top: 15px;
            font-weight: 400;
        }

        .save-btn {
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 6px;
            font-size: 0.95em;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
            width: 100%;
            font-weight: 500;
        }

        .save-btn:hover {
            background: #333;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        .save-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .view-history-btn {
            background: white;
            color: #666;
            border: 1px solid #e0e0e0;
            padding: 12px 35px;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            font-weight: 500;
            margin-top: 12px;
        }

        .view-history-btn:hover {
            background: #f5f5f5;
            border-color: #ccc;
        }

        .calendar {
            background: white;
            padding: 35px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            margin-top: 30px;
            border: 1px solid #e8e8e8;
        }

        .calendar-title {
            font-size: 1.3em;
            margin-bottom: 25px;
            color: #1a1a1a;
            font-weight: 600;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(32px, 1fr));
            gap: 6px;
            max-width: 100%;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: #f5f5f5;
            border-radius: 4px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e8e8e8;
        }

        .calendar-day:hover {
            transform: scale(1.05);
            background: #e8e8e8;
        }

        .calendar-day.written {
            background: #1a1a1a;
            border-color: #1a1a1a;
        }

        .calendar-day.today {
            border: 2px solid #666;
            box-shadow: 0 0 0 1px #666;
        }

        .calendar-day:hover::after {
            content: attr(data-date);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a1a;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.75em;
            white-space: nowrap;
            z-index: 10;
            margin-bottom: 8px;
        }

        .success-message {
            background: #1a1a1a;
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 25px;
            display: none;
            animation: slideDown 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 40px;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .modal-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 30px 35px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 8px 8px 0 0;
            z-index: 10;
        }

        .modal-header h2 {
            color: #1a1a1a;
            font-size: 1.8em;
            font-weight: 600;
        }

        .close-modal {
            background: transparent;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            background: #f0f0f0;
            color: #1a1a1a;
        }

        .modal-body {
            padding: 35px;
        }

        .entries-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .entry-card {
            background: #fafafa;
            border-radius: 8px;
            padding: 25px;
            border-left: 4px solid #1a1a1a;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid #e8e8e8;
        }

        .entry-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            background: white;
        }

        .entry-card.expanded {
            background: white;
            border-left-width: 4px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .entry-date {
            font-weight: 600;
            color: #1a1a1a;
            font-size: 1.05em;
        }

        .entry-meta {
            color: #999;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .entry-preview {
            color: #333;
            line-height: 1.6;
            font-size: 1em;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .entry-card.expanded .entry-preview {
            display: block;
            -webkit-line-clamp: unset;
        }

        .entry-preview h1,
        .entry-preview h2,
        .entry-preview h3 {
            margin: 0.5em 0;
        }

        .entry-preview img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .entry-actions {
            display: none;
            gap: 10px;
            margin-top: 18px;
            padding-top: 18px;
            border-top: 1px solid #e8e8e8;
        }

        .entry-card.expanded .entry-actions {
            display: flex;
        }

        .entry-btn {
            padding: 10px 22px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
            font-weight: 500;
        }

        .edit-btn {
            background: #1a1a1a;
            color: white;
        }

        .edit-btn:hover {
            background: #333;
        }

        .delete-btn {
            background: #dc2626;
            color: white;
        }

        .delete-btn:hover {
            background: #b91c1c;
        }

        .collapse-btn {
            background: #f0f0f0;
            color: #666;
        }

        .collapse-btn:hover {
            background: #e0e0e0;
        }

        .no-entries {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-entries-icon {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .no-entries h3 {
            color: #666;
            margin-bottom: 10px;
        }

        .search-filter {
            margin-bottom: 25px;
            position: sticky;
            top: 94px;
            background: white;
            padding: 15px 0;
            z-index: 9;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.2s;
            background: white;
            color: #1a1a1a;
        }

        .search-input:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        .search-input::placeholder {
            color: #999;
        }

        @media (max-width: 600px) {
            body {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .header p {
                font-size: 0.9em;
            }
            
            .stats {
                gap: 12px;
            }
            
            .stat-card {
                min-width: 130px;
                padding: 20px 25px;
            }

            .stat-number {
                font-size: 2em;
            }

            .prompt-card {
                padding: 25px 20px;
            }

            .refresh-prompt {
                top: 20px;
                right: 20px;
            }

            .writing-area {
                padding: 30px 25px;
            }

            .modal-content {
                margin: 0;
                max-height: 95vh;
            }

            .modal-header {
                padding: 25px 20px;
            }

            .modal-header h2 {
                font-size: 1.5em;
            }

            .modal-body {
                padding: 25px 20px;
            }

            .entry-card {
                padding: 20px;
            }

            .calendar {
                padding: 25px 20px;
            }

            .formatting-toolbar {
                gap: 3px;
                padding: 6px;
            }

            .format-btn {
                padding: 6px 10px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Journal</h1>
            <p>Learn, reflect, grow. Every day, a step forward.</p>
        </div>

        <div class="success-message" id="successMessage">
            <span id="successText">Entry saved!</span>
        </div>

        <div class="stats">
            <div class="stat-card">
                <span class="stat-number" id="streakCount">0</span>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalEntries">0</span>
                <div class="stat-label">Total Entries</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalWords">0</span>
                <div class="stat-label">Total Words</div>
            </div>
        </div>

        <div class="prompt-card" id="promptCard">
            <button class="refresh-prompt" id="refreshPrompt" title="Get new prompt">↻</button>
            <div class="prompt-label">Today's Prompt</div>
            <div class="prompt-text" id="promptText">Loading...</div>
        </div>

        <div class="writing-area">
            <div class="writing-controls">
                <div class="goal-selector">
                    <button class="goal-btn active" data-goal="words">100 words</button>
                    <button class="goal-btn" data-goal="time">5 minutes</button>
                    <button class="goal-btn" data-goal="sentence">1 sentence</button>
                </div>
                <div class="timer" id="timer"></div>
            </div>

            <div class="photo-section">
                <input type="file" id="photoInput" accept="image/*" style="display: none;">
                <button class="photo-btn" id="photoBtn">Add Photo</button>
                <div class="photo-preview" id="photoPreview"></div>
            </div>

            <div class="formatting-toolbar">
                <button class="format-btn" data-format="h1" title="Large Title">Title</button>
                <button class="format-btn" data-format="h2" title="Subtitle">Subtitle</button>
                <button class="format-btn" data-format="h3" title="Heading">Heading</button>
                <button class="format-btn" data-format="p" title="Normal Text">Normal</button>
                <button class="format-btn" data-format="bold" title="Bold"><strong>B</strong></button>
                <button class="format-btn" data-format="italic" title="Italic"><em>I</em></button>
                <button class="format-btn" data-format="quote" title="Quote">Quote</button>
            </div>

            <div id="journalEntry" class="rich-editor" contenteditable="true" data-placeholder="Start writing your thoughts..."></div>
            
            <div class="word-count" id="wordCount">0 words</div>
            
            <button class="save-btn" id="saveBtn">Save Entry</button>
            <button class="view-history-btn" id="viewHistoryBtn">View All Entries</button>
        </div>

        <div class="calendar">
            <div class="calendar-title">Your Writing Journey (Last 60 Days)</div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Your Journal Entries</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="search-filter">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search your entries...">
                </div>
                <div class="entries-list" id="entriesList">
                    <!-- Entries will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const prompts = [
            "What made you smile today?",
            "Describe a challenge you faced and how you handled it.",
            "What are you grateful for right now?",
            "If today was a movie, what genre would it be and why?",
            "What's one thing you learned about yourself today?",
            "Write about a conversation that stuck with you.",
            "What would you tell your younger self about today?",
            "Describe your perfect day. How close was today to that?",
            "What's something you're looking forward to?",
            "If you could relive one moment from today, which would it be?",
            "What emotions did you experience today and why?",
            "Write a letter to your future self about today.",
            "What would you change about today if you could?",
            "Describe the most interesting thing you saw or heard today.",
            "What's one small victory you had today?",
            "How did you take care of yourself today?",
            "What's on your mind right now?",
            "Describe your day using only five words, then explain.",
            "What did you create, make, or accomplish today?",
            "Who made a difference in your day and how?",
            "What's something you want to remember about this moment in your life?",
            "If today had a soundtrack, what would be playing?",
            "What's a problem you're working through right now?",
            "Describe a moment of peace you experienced today.",
            "What would you like tomorrow to bring?"
        ];

        let currentGoal = 'words';
        let startTime = null;
        let timerInterval = null;
        let currentPhoto = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            setRandomPrompt();
            renderCalendar();
            updateStats();
            setupEventListeners();
            checkTodayEntry();
        });

        function setupEventListeners() {
            // Goal buttons
            document.querySelectorAll('.goal-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.goal-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentGoal = btn.dataset.goal;
                    resetTimer();
                });
            });

            // Refresh prompt
            document.getElementById('refreshPrompt').addEventListener('click', (e) => {
                e.stopPropagation();
                setRandomPrompt();
            });

            // Prompt card click
            document.getElementById('promptCard').addEventListener('click', () => {
                document.getElementById('journalEntry').focus();
            });

            // Rich editor input
            const editor = document.getElementById('journalEntry');
            editor.addEventListener('input', () => {
                updateWordCount();
                if (!startTime && editor.textContent.trim().length > 0) {
                    startTimer();
                }
            });

            // Formatting toolbar
            document.querySelectorAll('.format-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const format = btn.dataset.format;
                    applyFormat(format);
                });
            });

            // Photo upload
            document.getElementById('photoBtn').addEventListener('click', () => {
                document.getElementById('photoInput').click();
            });

            document.getElementById('photoInput').addEventListener('change', handlePhotoUpload);

            // Save button
            document.getElementById('saveBtn').addEventListener('click', saveEntry);

            // View history button
            document.getElementById('viewHistoryBtn').addEventListener('click', openHistoryModal);
            
            // Close modal
            document.getElementById('closeModal').addEventListener('click', closeHistoryModal);
            document.getElementById('historyModal').addEventListener('click', (e) => {
                if (e.target.id === 'historyModal') {
                    closeHistoryModal();
                }
            });

            // Search entries
            document.getElementById('searchInput').addEventListener('input', filterEntries);

            // Auto-save every 30 seconds
            setInterval(autoSave, 30000);
        }

        function applyFormat(format) {
            const editor = document.getElementById('journalEntry');
            editor.focus();
            
            switch(format) {
                case 'h1':
                    document.execCommand('formatBlock', false, '<h1>');
                    break;
                case 'h2':
                    document.execCommand('formatBlock', false, '<h2>');
                    break;
                case 'h3':
                    document.execCommand('formatBlock', false, '<h3>');
                    break;
                case 'p':
                    document.execCommand('formatBlock', false, '<p>');
                    break;
                case 'bold':
                    document.execCommand('bold', false, null);
                    break;
                case 'italic':
                    document.execCommand('italic', false, null);
                    break;
                case 'quote':
                    document.execCommand('formatBlock', false, '<blockquote>');
                    break;
            }
        }

        function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    currentPhoto = event.target.result;
                    displayPhoto(currentPhoto);
                };
                reader.readAsDataURL(file);
            }
        }

        function displayPhoto(photoData) {
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = `
                <img src="${photoData}" alt="Journal photo">
                <button class="remove-photo" onclick="removePhoto()">×</button>
            `;
            preview.classList.add('has-photo');
        }

        function removePhoto() {
            currentPhoto = null;
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = '';
            preview.classList.remove('has-photo');
            document.getElementById('photoInput').value = '';
        }

        function setRandomPrompt() {
            const promptText = document.getElementById('promptText');
            const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
            promptText.textContent = randomPrompt;
        }

        function updateWordCount() {
            const editor = document.getElementById('journalEntry');
            const text = editor.textContent || editor.innerText;
            const words = text.trim().split(/\s+/).filter(word => word.length > 0).length;
            document.getElementById('wordCount').textContent = `${words} words`;
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function resetTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = null;
            document.getElementById('timer').textContent = '';
        }

        function saveEntry() {
            const editor = document.getElementById('journalEntry');
            const html = editor.innerHTML.trim();
            const text = editor.textContent.trim();
            
            if (!text) {
                alert('Please write something before saving!');
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const entries = getEntries();
            
            const wordCount = text.split(/\s+/).filter(word => word.length > 0).length;
            
            entries[today] = {
                html: html,
                text: text,
                wordCount: wordCount,
                photo: currentPhoto,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('journalEntries', JSON.stringify(entries));
            
            showSuccessMessage();
            updateStats();
            renderCalendar();
            
            // Clear for next entry
            setTimeout(() => {
                editor.innerHTML = '';
                removePhoto();
                updateWordCount();
                resetTimer();
            }, 1500);
        }

        function autoSave() {
            const editor = document.getElementById('journalEntry');
            const html = editor.innerHTML.trim();
            const text = editor.textContent.trim();
            
            if (text) {
                const today = new Date().toISOString().split('T')[0];
                const draft = { 
                    html, 
                    text,
                    photo: currentPhoto,
                    timestamp: new Date().toISOString() 
                };
                localStorage.setItem(`draft_${today}`, JSON.stringify(draft));
            }
        }

        function checkTodayEntry() {
            const today = new Date().toISOString().split('T')[0];
            const draft = localStorage.getItem(`draft_${today}`);
            
            if (draft) {
                const { html, photo } = JSON.parse(draft);
                document.getElementById('journalEntry').innerHTML = html;
                if (photo) {
                    currentPhoto = photo;
                    displayPhoto(photo);
                }
                updateWordCount();
            }
        }

        function showSuccessMessage() {
            const msg = document.getElementById('successMessage');
            const entries = getEntries();
            const streak = calculateStreak(entries);
            
            let text = 'Entry saved!';
            if (streak === 1) text = 'Entry saved! Start of your journey.';
            else if (streak === 7) text = 'Entry saved! One week streak!';
            else if (streak === 30) text = 'Entry saved! 30 days strong!';
            else if (streak % 10 === 0) text = `Entry saved! ${streak} day streak!`;
            
            document.getElementById('successText').textContent = text;
            msg.style.display = 'block';
            
            setTimeout(() => {
                msg.style.display = 'none';
            }, 3000);
        }

        function getEntries() {
            return JSON.parse(localStorage.getItem('journalEntries') || '{}');
        }

        function updateStats() {
            const entries = getEntries();
            const dates = Object.keys(entries).sort();
            
            document.getElementById('streakCount').textContent = calculateStreak(entries);
            document.getElementById('totalEntries').textContent = dates.length;
            
            const totalWords = dates.reduce((sum, date) => 
                sum + (entries[date].wordCount || 0), 0);
            document.getElementById('totalWords').textContent = totalWords.toLocaleString();
        }

        function calculateStreak(entries) {
            const dates = Object.keys(entries).sort().reverse();
            if (dates.length === 0) return 0;
            
            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let i = 0; i < dates.length; i++) {
                const entryDate = new Date(dates[i]);
                entryDate.setHours(0, 0, 0, 0);
                
                const expectedDate = new Date(today);
                expectedDate.setDate(expectedDate.getDate() - i);
                expectedDate.setHours(0, 0, 0, 0);
                
                if (entryDate.getTime() === expectedDate.getTime()) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            const entries = getEntries();
            const today = new Date();
            
            for (let i = 59; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.dataset.date = dateStr;
                
                if (entries[dateStr]) {
                    day.classList.add('written');
                    day.title = `${entries[dateStr].wordCount} words`;
                }
                
                if (i === 0) {
                    day.classList.add('today');
                }
                
                grid.appendChild(day);
            }
        }

        function openHistoryModal() {
            document.getElementById('historyModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            loadEntries();
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function loadEntries(searchTerm = '') {
            const entries = getEntries();
            const entriesList = document.getElementById('entriesList');
            const dates = Object.keys(entries).sort().reverse();
            
            if (dates.length === 0) {
                entriesList.innerHTML = `
                    <div class="no-entries">
                        <div class="no-entries-icon">📝</div>
                        <h3>No entries yet</h3>
                        <p>Start writing to see your journal history here!</p>
                    </div>
                `;
                return;
            }

            const filteredDates = searchTerm 
                ? dates.filter(date => entries[date].text.toLowerCase().includes(searchTerm.toLowerCase()))
                : dates;

            if (filteredDates.length === 0) {
                entriesList.innerHTML = `
                    <div class="no-entries">
                        <div class="no-entries-icon">🔍</div>
                        <h3>No matches found</h3>
                        <p>Try a different search term</p>
                    </div>
                `;
                return;
            }

            entriesList.innerHTML = filteredDates.map(date => {
                const entry = entries[date];
                const formattedDate = new Date(date).toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const photoHTML = entry.photo ? `<img src="${entry.photo}" alt="Journal photo">` : '';
                const contentHTML = entry.html || entry.text;
                
                return `
                    <div class="entry-card" data-date="${date}">
                        <div class="entry-header">
                            <div class="entry-date">${formattedDate}</div>
                            <div class="entry-meta">${entry.wordCount || 0} words</div>
                        </div>
                        <div class="entry-preview">${photoHTML}${contentHTML}</div>
                        <div class="entry-actions">
                            <button class="entry-btn edit-btn" onclick="editEntry('${date}')">Edit</button>
                            <button class="entry-btn delete-btn" onclick="deleteEntry('${date}')">Delete</button>
                            <button class="entry-btn collapse-btn" onclick="collapseEntry('${date}')">Collapse</button>
                        </div>
                    </div>
                `;
            }).join('');

            // Add click handlers to expand entries
            document.querySelectorAll('.entry-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('entry-btn')) {
                        card.classList.toggle('expanded');
                    }
                });
            });
        }

        function filterEntries() {
            const searchTerm = document.getElementById('searchInput').value;
            loadEntries(searchTerm);
        }

        function editEntry(date) {
            const entries = getEntries();
            const entry = entries[date];
            
            if (confirm('Load this entry for editing? (Your current draft will be replaced)')) {
                const editor = document.getElementById('journalEntry');
                editor.innerHTML = entry.html || entry.text;
                
                if (entry.photo) {
                    currentPhoto = entry.photo;
                    displayPhoto(entry.photo);
                }
                
                updateWordCount();
                closeHistoryModal();
                
                // Scroll to writing area
                editor.scrollIntoView({ behavior: 'smooth' });
                editor.focus();
            }
        }

        function deleteEntry(date) {
            const entries = getEntries();
            const formattedDate = new Date(date).toLocaleDateString('en-US', {
                month: 'long',
                day: 'numeric',
                year: 'numeric'
            });
            
            if (confirm(`Are you sure you want to delete your entry from ${formattedDate}? This cannot be undone.`)) {
                delete entries[date];
                localStorage.setItem('journalEntries', JSON.stringify(entries));
                
                loadEntries(document.getElementById('searchInput').value);
                updateStats();
                renderCalendar();
            }
        }

        function collapseEntry(date) {
            const card = document.querySelector(`[data-date="${date}"]`);
            if (card) {
                card.classList.remove('expanded');
            }
        }

        function loadData() {
            // Migration from old storage if needed
            const oldEntry = localStorage.getItem('todayEntry');
            if (oldEntry) {
                const today = new Date().toISOString().split('T')[0];
                const entries = getEntries();
                if (!entries[today]) {
                    entries[today] = {
                        text: oldEntry,
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem('journalEntries', JSON.stringify(entries));
                }
                localStorage.removeItem('todayEntry');
            }
        }
    </script>
</body>
</html>